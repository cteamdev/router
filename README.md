# @cteamdev/router
üî™ –ú–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–æ—É—Ç–µ—Ä –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ React –∏ VKUI

- –ü–ª—é—Å—ã
- –ö–æ–≥–¥–∞-–Ω–∏–±—É–¥—å
- –û–Ω–∏
- –¢—É—Ç
- –ë—É–¥—É—Ç

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
npm install --save @cteamdev/router
```
```bash
yarn add @cteamdev/router
```

## –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
1. –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `Router` (–≤–∞–∂–Ω–æ —ç—Ç–æ –¥–µ–ª–∞—Ç—å –Ω–∞–¥ `Structure`):
```tsx
<Router>
  <App />
</Router>
```

2. –ï—Å–ª–∏ —Ö–æ—Ç–∏–º –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, —Ç–æ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `Structure`:
```tsx
<Structure>
  <Root>
    ...
  </Root>
</Structure>
```

3. –í—Å–µ `Root`, `Epic` –∏ `View` –∏–∑ `VKUI` –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ —Ä–æ—É—Ç–µ—Ä–∞:
```tsx
// –í–µ—Ä–Ω–æ:
import { Root, Epic, View } from '@cteamdev/router';

// –ù–µ –≤–µ—Ä–Ω–æ:
import { Root, Epic, View } from '@vkontakte/vkui';
```

4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä (–≤–∞–∂–Ω–æ –¥–µ–ª–∞—Ç—å —ç—Ç–æ –∫–∞–∫ –º–æ–∂–Ω–æ —Ä–∞–Ω—å—à–µ - –¥–æ –ø–µ—Ä–≤–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∞ –≤ –≥–ª–∞–≤–Ω–æ–º —Ñ–∞–π–ª–µ):
```tsx
import { render } from 'react-dom';
import { init } from '@cteamdev/router';

import { App } from './App';

init(options?: Options, structure?: RootStructure);
render(<App />, document.getElementById('root'));
```
### `options`
–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–æ—É—Ç–µ—Ä–∞.
| –ö–ª—é—á | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------------|----------|
| `mode` | `hash` | –ú–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –ª–æ–∫–∞—Ü–∏–∏ –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è `none`, `path` –∏ `hash`. |
| `style` | `auto` | –°—Ç–∏–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è `auto`, `mobile` –∏ `desktop`. |
| `defaultRoute` | `/` | –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏–ª–∏ –Ω–µ –ø—É—Å—Ç–æ–º —ç–∫—Ä–∞–Ω–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/`. |
| `shouldClose` | `true`, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω `vk-bridge` | –ù—É–∂–Ω–æ –ª–∏ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ *–ù–∞–∑–∞–¥* –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –∏—Å—Ç–æ—Ä–∏–∏. |
| `debug` | `false` | –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (–≤—ã–≤–æ–¥ —Å–æ–±—ã—Ç–∏–π –≤ –∫–æ–Ω—Å–æ–ª—å). |
### `structure`
–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
| –§—É–Ω–∫—Ü–∏—è | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----------|----------|
| `push(path: string, meta?: Meta)` | - `path` - –ø—É—Ç—å –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ. <br/>- `meta` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å. | –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ. |
| `replace(path: string, meta?: Meta)` | - `path` - –ø—É—Ç—å –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ. <br/>- `meta` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å. | –ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞ –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é. |
| `back()` | - | –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ. |
| `go(delta: number)` | - `delta` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤. | –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ `delta` —à–∞–≥–æ–≤ –≤–ø–µ—Ä—ë–¥/–Ω–∞–∑–∞–¥. |

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã - —ç—Ç–æ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ. –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –º–µ—Ç–æ–¥–∞—Ö `push` –∏ `replace` –≤–º–µ—Å—Ç–µ —Å `path`:
```typescript
push('/persik?mode=default');
replace('/persik?mode=gray');
```
–ü–æ–º–Ω–∏—Ç–µ, —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—Å–µ–≥–¥–∞ –∏–º–µ—é—Ç —Ç–∏–ø `string`.

–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ - —ç—Ç–æ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Å –æ–¥–Ω–æ–π –ø–∞–Ω–µ–ª–∏ –∫ –¥—Ä—É–≥–æ–π. –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –º–µ—Ç–æ–¥–∞—Ö `push` –∏ `replace` –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–µ `meta`:
```typescript
push('/persik', {
  url: 'https://cdn.pavgro.world/persik/'
});
replace('/persik', {
  url: 'https://cdn.pavgro.world/cat/'
});
```

–ü–æ–ª—É—á–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ —Å –ø–æ–º–æ—â—å—é —Ö—É–∫–æ–≤ `useParams()` –∏ `useMeta()`:
```tsx
type Props = {
  nav: string;
};
type P = {
  mode?: string;
}
type M = {
  url?: string;
};

const Persik: FC<Props> = ({ nav }) => {
  const { mode } = useParams<P>();
  const { url } = useMeta<M>();

  return (
    <Panel nav={nav}>
      <PanelHeader>–ü–µ—Ä—Å–∏–∫</PanelHeader>

      <Div>
        <img src={url ? url + (mode ?? 'default') : 'https://persik.pavgro.world/'} />
      </Div>

      <Div>
        <Button
          size="l"
          onClick={() => back()}
        >
          –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞–∑–∞–¥
        </Button>
      </Div>
    </Panel>
  );
};
```

### –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
–ö–∞–∫ –≤—ã –º–æ–≥–ª–∏ –∑–∞–º–µ—Ç–∏—Ç—å, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –º–µ–Ω—è—é—Ç —Å–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–º–µ–Ω—ã –ø–∞–Ω–µ–ª–∏). –î–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –∞ –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö - –Ω–µ —Å–æ–≤—Å–µ–º. –í —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ —Å–µ–π—á–∞—Å –º–æ–∂–Ω–æ —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:
1. –ü–æ–ª—É—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞:
```tsx
const { state } = useRouter();
```
2. –î–µ–ª–∞–µ–º —Ä–µ—Ñ –Ω–∞ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞:
```tsx
const refId = useRef(state.id);
```
3. –ü—Ä–æ–∫–∏–¥—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–µ—Ñ–∞ –≤ –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç —Ö—É–∫–∞ `useMeta`:
```tsx
const meta = useMeta(refId.current);
```
> –ò–∑–≤–µ—Å—Ç–Ω—ã–π –±–∞–≥: –ª–æ–º–∞–µ—Ç—Å—è –ø—Ä–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å–≤–∞–π–ø–±—ç–∫–∞ - https://github.com/cteamdev/router/issues/6.

## –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
–ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞, –Ω—É–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `ModalRoot` –∏–∑ —Ä–æ—É—Ç–µ—Ä–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤–º–µ—Å—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ:
```tsx
import { ModalRoot } from '@cteamdev/router';

//...
<SplitLayout
  modal={
    <ModalRoot>
      <MyModal nav="my" />
    </ModalRoot>
  }
></SplitLayout>
```

–ü–µ—Ä–µ—Ö–æ–¥ –∫ –º–æ–¥–∞–ª—å–Ω–æ–º—É –æ–∫–Ω—É:
```tsx
push('/?modal=my');
```

## –ü–æ–ø–∞—É—Ç—ã
–ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ø–∞—É—Ç—ã –æ–∫–Ω–∞, –Ω—É–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `PopoutRoot` –∏–∑ —Ä–æ—É—Ç–µ—Ä–∞:
```tsx
import { PopoutRoot } from '@cteamdev/router';

//...
<SplitLayout
  popout={
    <PopoutRoot>
      <MyPopout nav="my" />
      <ScreenSpinner id="loading" />
    </PopoutRoot>
  }
></SplitLayout>
```

–ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø–æ–ø–∞—É—Ç—É:
```tsx
push('/?popout=my');
```

–ß—Ç–æ–±—ã –Ω–µ–ª—å–∑—è –±—ã–ª–æ –∑–∞–∫—Ä—ã—Ç—å –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –≤–ø–µ—Ä—ë–¥:
```tsx
push('/?popout=loading');
lock();

// –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
setTimeout(() => {
  unlock();
  replace('/');
}, 2000);
```

## –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
–ù–∞–ø—Ä–∏–º–µ—Ä, –≤–∞–º –Ω—É–∂–Ω–æ –Ω–µ –≤—ã–ø—É—Å–∫–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∏–≥—Ä—ã. –° —ç—Ç–æ–π –∑–∞–¥–∞—á–µ–π –æ—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–∏—Ç—Å—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞:
```tsx
type Props = {
  nav: string;
};

const Game: FC<Props> = ({ nav }) => {
  const { back, lock, unlock } = useRouter();

  useEffect(lock, []);

  return (
    <Panel nav={nav}>
      <PanelHeader
        left={<PanelHeaderBack onClick={back} />}
      >
        –ò–≥—Ä–∞
      </PanelHeader>

      <Div>
        {/* –í–∂—É—Ö, –≥–æ–Ω–∫–∏! */}
      </Div>

      <Div>
        <Button
          size="l"
          onClick={unlock}
        >
          –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
        </Button>
      </Div>
    </Panel>
  );
};
```

## –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π/–ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ, —Å–º–µ–Ω–∞ —Ö—ç—à–∞ –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ - —ç—Ç–æ –≤—Å—ë —Å–æ–±—ã—Ç–∏—è. –ß—Ç–æ–±—ã –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –Ω–∏—Ö, –Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ `subscribe`, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–ø–∏—Å–∫–∏:
```tsx
const App: FC = () => {
  const { subscribe } = useRouter();

  useEffect(() => {
    const handler = (event: RouterEvent, state: State | null) => {
      console.log('–ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ:', event, '–°–æ—Å—Ç–æ—è–Ω–∏–µ: ', state);

      if (event === RouterEvent.PUSH) {
        console.log('–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π –ø–∞–Ω–µ–ª–∏', state?.panel);
      }
    };

    return subscribe(handler);
  }, []);

  return (
    ...
  );
};
```

## ViewInfinite
–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç VKUI. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ—á–Ω–æ —Ç–∞–∫–æ–µ –∂–µ, –∫–∞–∫ –∏ —Å –æ–±—ã—á–Ω—ã–º `View` - –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ –∏—Å—Ç–æ—Ä–∏–µ–π –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Ä–æ—É—Ç–µ—Ä.

## –ü—Ä–∏–º–µ—Ä
```tsx
// panels/home.tsx
type Props = {
  nav: string;
};

const Home: FC<Props> = ({ nav }) => {
  const { push } = useRouter();

  return (
    <Panel nav={nav}>
      <PanelHeader>–ì–ª–∞–≤–Ω–∞—è</PanelHeader>

      <Div>
        <Button
          size="l"
          onClick={() => push('/persik?mode=default', { url: 'none' })}
        >
          –ü–µ—Ä–µ–π—Ç–∏ –∫–æ –≤—Ç–æ—Ä–æ–π –ø–∞–Ω–µ–ª–∏
        </Button>
      </Div>
    </Panel>
  );
};

// panels/persik.tsx
type Props = {
  nav: string;
};

const Persik: FC<Props> = ({ nav }) => {
  const { back } = useRouter();

  const params = useParams();
  const meta = useMeta();

  return (
    <Panel nav={nav}>
      <PanelHeader>–ü–µ—Ä—Å–∏–∫</PanelHeader>

      <Div>
        <Text>
          –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: {JSON.stringify(params)}
          –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: {JSON.stringify(meta)}
        </Text>
        <Button
          size="l"
          onClick={() => back()}
        >
          –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞–∑–∞–¥
        </Button>
      </Div>
    </Panel>
  );
};

// App.tsx
const App: FC = () => {
  return (
    <Structure>
      <Root>
        <View nav="/">
          <Home nav="/" />
          <Persik nav="/persik" />
        </View>
      </Root>
    </Structure>
  );
};

// index.tsx
import { render } from 'react-dom';
import { init } from '@cteamdev/router';

import { App } from './App';

init({
  debug: true
});
render(
  <Router>
    <App />
  </Router>,
  document.getElementById('root')
);
```